{% extends 'base.html' %}
{% load static %}
{% block title %}Usuários do Sistema{% endblock %}
{% block local_style %}{% endblock %}

{% block content %}


<div class="content-wrapper">
    <div class="row">
        <div class="col-lg-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <h4 class="card-title">Lista de Usuários Registrados</h4>
                        <a href="{% url 'users:register-view' %}" class="btn btn-primary">
                            <i class="typcn typcn-user-add-outline menu-icon"></i>
                            Novo Usuário
                        </a>
                    </div>
                    <!-- <p class="card-description">
                        Add class <code>.table-striped</code>
                    </p> -->
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Usuário</th>
                                    <th>Nome</th>
                                    <th>Área</th>
                                    <th>Criado a </th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td class="py-1">
                                        {% if user.profile.image %}
                                        <img onmouseenter='showModal("modalUser{{user.id}}")'
                                            src="{{ user.profile.image.url }}"
                                            alt="Imagem de perfil de {{ user.get_full_name}}" />
                                        {% else %}
                                        <img onmouseenter='showModal("modalUser{{user.id}}")'
                                            src="{% static 'assets/images/user.png' %}" alt="Sem imagem de perfil" />
                                        {% endif %}
                                    </td>
                                    <td>{{user.get_full_name}}</td>
                                    <td>{{user.profile.area}}</td>
                                    <td>{{user.date_joined}}</td>

                                    <td>
                                        <div class="d-flex align-items-center">
                                            <a title="Editar" href="{% url 'users:edit-view' user.id %}"
                                                class="btn btn-primary btn-sm btn-icon-text mr-3">
                                                <i class="typcn typcn-edit btn-icon-append"></i>
                                            </a>

                                            <button title="Detalhes do usuário {{user.get_full_name}}" type="button"
                                                class="btn btn-primary btn-sm btn-icon-text mr-3" data-toggle="modal"
                                                data-target="#modalUser{{user.id}}">
                                                <i class="bi bi-eye btn-icon-append"></i>
                                            </button>

                                            <button title="Eliminar usuário {{user.get_full_name}}" type="button"
                                                class="btn btn-primary btn-sm btn-icon-text mr-3" data-toggle="modal"
                                                data-target="#modalUserDelete{{user.id}}">
                                                <i class="typcn typcn-delete-outline btn-icon-append"></i>
                                            </button>

                                            
                                        </div>
                                    </td>
                                    {% include 'users/partials/modal-user-details.html' %}
                                    {% include 'users/partials/modal-user-delete.html' %}
                                </tr>

                                {% empty %}
                                <tr>
                                    <td colspan=4>
                                        <p>Não há Usuários registradas</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="clearfix mt-5">
                            <div class="hint-text text-center">
                                Mostrando <b>
                                    {{users.number }}</b> de <b>
                                    {{ users.paginator.num_pages}}

                                </b>
                            </div>
                            <ul class="pagination d-flex justify-content-center">
                                {% if users.has_previous %}
                                <li class="page-item "><a href="?page={{ users.previous_page_number }}"
                                        class="page-link">Anterior</a>
                                </li>
                                {% endif %}

                                {% for num_page in users.paginator.page_range %}

                                <li class="page-item {% if num_page == users.number %}active{% endif %}">
                                    <a href="?page={{ num_page }}" class="page-link">{{ num_page }}</a>
                                </li>
                                {% endfor %}

                                {% if users.has_next %}
                                <li class="page-item ">
                                    <a href="?page={{ users.next_page_number }}" class="page-link">
                                        Próximo
                                    </a>
                                </li>
                                <li class="page-item ">
                                    <a href="?page={{ users.paginator.num_pages }}" class="page-link">Última &raquo;</a>
                                </li>
                                {% endif %}
                            </ul>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block local_script %}
<script src="{% static 'assets/js/off-canvas.js' %}"></script>
<script src="{% static 'assets/js/hoverable-collapse.js' %}"></script>
<script src="{% static 'assets/js/template.js' %}"></script>
<script src="{% static 'assets/js/settings.js' %}"></script>
<script src="{% static 'assets/js/todolist.js' %}"></script>

{% endblock%}